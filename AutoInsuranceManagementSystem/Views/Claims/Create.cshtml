@model AutoInsuranceManagementSystem.ViewModels.ClaimCreateViewModel
@using Microsoft.AspNetCore.Identity
@inject SignInManager<ApplicationUser> SignInManager
@{
    ViewData["Title"] = "Submit New Claim";
    var isAdmin = User.IsInRole("Admin");
}

@section Styles {
    <style>
        :root {
            /* Assuming --brand-primary, --brand-primary-darker, --bs-success, --bs-success-darker are defined in _Layout.cshtml or here */
            --claim-form-card-radius: 0.75rem;
            --claim-header-admin-bg: linear-gradient(135deg, var(--brand-primary-darker, #1e5abc), var(--brand-primary, #2a6fdb));
            --claim-header-customer-bg: linear-gradient(135deg, var(--bs-success-darker, #146c43), var(--bs-success, #198754));
            --form-section-title-color: #2c3e50;
            --form-icon-color: var(--brand-primary, #2a6fdb); /* Default to primary, can be conditional */
            --form-field-border: #ced4da;
            --form-focus-border: var(--brand-primary, #2a6fdb);
            --form-focus-shadow: rgba(var(--bs-primary-rgb, 42, 111, 219), 0.25);
            /* If success color is used for focus when customer */
            --form-focus-border-customer: var(--bs-success, #198754);
            --form-focus-shadow-customer: rgba(var(--bs-success-rgb, 25, 135, 84), 0.25);
        }

        .submit-claim-card {
            border-radius: var(--claim-form-card-radius);
            background-color: #fff;
            /* Base shadow/border should come from global .card in _Layout.cshtml */
        }

            .submit-claim-card .card-header {
                /* background is set dynamically in HTML */
                color: #fff !important;
                border-bottom: none;
                padding: 1.25rem 1.75rem;
                border-top-left-radius: var(--claim-form-card-radius) !important;
                border-top-right-radius: var(--claim-form-card-radius) !important;
            }

                .submit-claim-card .card-header.admin-header {
                    background: var(--claim-header-admin-bg) !important;
                }

                .submit-claim-card .card-header.customer-header {
                    background: var(--claim-header-customer-bg) !important;
                }

                .submit-claim-card .card-header h4 {
                    font-family: 'Poppins', sans-serif;
                    font-weight: 600;
                    font-size: 1.5rem;
                    margin-bottom: 0;
                }

                .submit-claim-card .card-header .bi {
                    font-size: 1.2em;
                    vertical-align: -0.1em;
                    margin-right: 0.6rem;
                }

            .submit-claim-card .card-body {
                padding: 2rem 2.5rem; /* Increased horizontal padding slightly */
            }
            /* Standardize bottom margin for form groups and rows within the form */
            .submit-claim-card .mb-3,
            .submit-claim-card .mb-4,
            .submit-claim-card .row.g-3.mb-3 {
                margin-bottom: 1.75rem !important; /* Increased standard bottom margin */
            }


        .form-label.fw-semibold {
            font-weight: 500 !important; /* Inter */
            color: #343a40;
            margin-bottom: 0.4rem;
        }

        .form-control, .form-select {
            border-radius: 0.375rem; /* Default Bootstrap */
            border: 1px solid var(--form-field-border);
            padding: 0.6rem 0.9rem;
            transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;
        }

            .form-control.rounded-pill, .form-select.rounded-pill {
                border-radius: 50px !important;
                padding: 0.65rem 1rem; /* Slightly more padding for pill inputs */
            }

            .form-control.rounded-3 { /* For textarea */
                border-radius: 0.5rem !important; /* Slightly more rounded textarea */
            }

            .form-control:focus, .form-select:focus {
                border-color: @(isAdmin ? "var(--form-focus-border)" : "var(--form-focus-border-customer)");
                box-shadow: 0 0 0 0.2rem @(isAdmin ? "var(--form-focus-shadow)" : "var(--form-focus-shadow-customer)");
            }

        .input-group .input-group-text {
            border-color: var(--form-field-border);
            background-color: #f8f9fa;
            border-radius: 50px 0 0 50px; /* Match rounded-pill if input is pill */
        }

        .input-group .form-control.rounded-end-pill { /* Ensure specific styling for pill within group */
            border-radius: 0 50px 50px 0 !important;
        }
        /* Ensure focus outline is consistent with input when part of input-group */
        .input-group .form-control:focus ~ .input-group-text, /* For input first */
        .input-group .form-control:focus + .input-group-text, /* For input first, alternative selector */
        .input-group-text:has(+ .form-control:focus) /* For text first - CSS :has might not be fully supported in all older environments */ {
            border-color: @(isAdmin ? "var(--form-focus-border)" : "var(--form-focus-border-customer)");
        }
        /* Fallback for :has not being available if the above complex selector has issues, direct focus on input is primary */
        .form-control:focus + .input-group-text {
            border-color: @(isAdmin ? "var(--form-focus-border)" : "var(--form-focus-border-customer)");
        }


        /* Upload Section Enhancement */
        .upload-section {
            padding-top: 1.5rem;
            margin-top: 1.5rem;
            border-top: 1px solid #e0e7ff; /* Light separator line replaces hr */
        }

            .upload-section .upload-section-title { /* Class for the h5 */
                font-family: 'Poppins', sans-serif;
                font-weight: 600;
                color: var(--form-section-title-color);
                font-size: 1.2rem; /* Slightly smaller than main section titles */
                margin-bottom: 1.5rem; /* Space after title */
                display: flex;
                align-items: center;
            }

                .upload-section .upload-section-title .bi {
                    color: var(--form-icon-color); /* Use a consistent icon color */
                    margin-right: 0.75rem;
                    font-size: 1.1em; /* Relative to title */
                }

        .form-control[type="file"].rounded-pill {
            padding: 0.6rem 0.9rem; /* Ensure padding is consistent for file inputs */
        }
        /* Note: Styling the "Choose File" button within a file input is complex and browser-dependent.
               Relying on Bootstrap's default rendering with .rounded-pill is often the most straightforward. */

        .form-text {
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 0.4rem; /* Added a bit more space above form-text */
        }


        .action-buttons {
            margin-top: 2.5rem;
        }

            .action-buttons .btn {
                min-width: 150px;
                padding-top: 0.7rem;
                padding-bottom: 0.7rem;
                font-weight: 500;
            }

                .action-buttons .btn .bi {
                    vertical-align: -0.1em;
                }

    </style>
}

<div class="row justify-content-center">
    <div class="col-md-9 col-lg-8">
        <div class="card submit-claim-card">
            <div class="card-header @(isAdmin ? "admin-header" : "customer-header")">
                <h4 class="mb-0"><i class="bi bi-shield-exclamation"></i>@ViewData["Title"]</h4>
            </div>
            <div class="card-body">
                <form asp-action="Create" method="post" enctype="multipart/form-data">
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger rounded-3 mb-4" role="alert"></div>

                    <div class="mb-3">
                        <label asp-for="PolicyId" class="form-label fw-semibold">Select Your Policy</label>
                        <select asp-for="PolicyId" class="form-select rounded-pill" asp-items="ViewBag.AvailablePolicies">
                            <option value="">-- Select Policy --</option>
                        </select>
                        <span asp-validation-for="PolicyId" class="text-danger small"></span>
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label asp-for="ClaimDate" class="form-label fw-semibold">Date of Incident</label>
                            <input asp-for="ClaimDate" type="date" class="form-control rounded-pill" />
                            <span asp-validation-for="ClaimDate" class="text-danger small"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="ClaimAmount" class="form-label fw-semibold">Estimated Claim Amount</label>
                            <div class="input-group">
                                <span class="input-group-text rounded-start-pill">₹</span>
                                <input asp-for="ClaimAmount" type="number" step="0.01" class="form-control rounded-end-pill" placeholder="e.g., 15000.00" />
                            </div>
                            <span asp-validation-for="ClaimAmount" class="text-danger small"></span>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label asp-for="Description" class="form-label fw-semibold">Detailed Description of Incident</label>
                        <textarea asp-for="Description" class="form-control rounded-3" rows="5" placeholder="Describe the incident, damages, location, sequence of events, and any other relevant details..."></textarea>
                        <span asp-validation-for="Description" class="text-danger small"></span>
                    </div>

                    <div class="upload-section">
                        @* Removed <hr /> as its style is handled by .upload-section border-top *@
                        <h5 class="upload-section-title"><i class="bi bi-paperclip"></i>Upload Supporting Documents</h5>
                        <div class="mb-4">
                            <label asp-for="PhotoProof" class="form-label fw-semibold">Photo Proof (Images of Damage, Scene)</label>
                            <input asp-for="PhotoProof" type="file" class="form-control rounded-pill" accept="image/jpeg,image/png,image/gif" multiple />
                            <span asp-validation-for="PhotoProof" class="text-danger small"></span>
                            <div class="form-text">Accepted: JPG, PNG, GIF. Max 5MB per file. You can select multiple images.</div>
                        </div>
                        <div class="mb-3">
                            <label asp-for="VideoProof" class="form-label fw-semibold">Video Proof (Optional)</label>
                            <input asp-for="VideoProof" type="file" class="form-control rounded-pill" accept="video/mp4,video/quicktime,video/x-msvideo,video/x-matroska" />
                            <span asp-validation-for="VideoProof" class="text-danger small"></span>
                            <div class="form-text">Accepted: MP4, MOV, AVI, MKV. Max 50MB.</div>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end action-buttons">
                        <button type="submit" class="btn @(isAdmin ? "btn-primary" : "btn-success") rounded-pill px-4"><i class="bi bi-send-fill me-2"></i>Submit Claim</button>
                        @if (User.IsInRole("Customer"))
                        {
                            <a asp-controller="Claims" asp-action="MyClaims" class="btn btn-outline-secondary rounded-pill px-4"><i class="bi bi-arrow-left-circle-fill me-2"></i>Back to My Claims</a>
                        }
                        else
 @* Admin or other roles *@
                        {
                            <a asp-controller="Claims" asp-action="Index" class="btn btn-outline-secondary rounded-pill px-4"><i class="bi bi-arrow-left-circle-fill me-2"></i>Back to Claims List</a>
                        }
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}